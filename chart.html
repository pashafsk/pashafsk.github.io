<!DOCTYPE html>
   <head >
      <title>Moving Averages</title>
      <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	  
	  <style>
	  .trend tr:nth-child(even) {background-color: #f2f2f2;}
	  .ma tr:nth-child(even) {background-color: gray;}
	  
		table, th, td {
  border: 1px solid black;
}
	  
	 
	  </style>
	  
   </head>

   <body>
   
   <input type="text" id="tickerSymbol" />
   <button>Go!</button>
    <div class =  "symbol"> </div>
    <div class = "trend"> </div>
	<div class = "ma"> </div>
	<div class = "notes"> </div>
   
   <script>
    var getData = function(){
        var input = $('#tickerSymbol').val();
        var found = false;
		
        var url = "https://spreadsheets.google.com/feeds/list/1M_VbEIENgfewCAnYK1jrtytm0-CeA6Xw3H7CTEqZwAc/od6/public/values?alt=json"; //this is the part that's changed
		var iex = 'https://api.iextrading.com/1.0/stock/'+input+'/price';
		var chart = 'https://api.iextrading.com/1.0/stock/'+input+'/chart/3m';
		
		$.getJSON(iex, function(data){
			price = data;
		});
		 var value=[];
		$.getJSON(chart, function(data){
			$.each(data, function(index, daily){
			  //  console.log(daily.close);
				value.push(daily.close);
							 
			  })
			 			 
			   console.log(value.slice(value.length-7,value.length-2));
				 
			  //5ma trend
			  var x5ma =  value.slice(value.length-5,value.length).reduceRight(getSum);
			  var y5ma =  value.slice(value.length-6,value.length-1).reduceRight(getSum);
			  var z5ma =  value.slice(value.length-7,value.length-2).reduceRight(getSum);
			  
			  
			  //console.log('5ma trend ' +(z5ma/5).toFixed(2) + ' ' + (y5ma/5).toFixed(2) + ' ' + (x5ma/5).toFixed(2));
			  //end 5ma trend
			  //10ma trend
			  var x10ma =  value.slice(value.length-10,value.length).reduceRight(getSum);
			  var y10ma =  value.slice(value.length-11,value.length-1).reduceRight(getSum);
			  var z10ma =  value.slice(value.length-12,value.length-2).reduceRight(getSum);
			  console.log('10ma trend '+(z10ma/10).toFixed(2) + ' ' + (y10ma/10).toFixed(2) + ' ' + (x10ma/10).toFixed(2));
			  //end 10ma trend
			  //20ma trend
			  var x20ma =  value.slice(value.length-20,value.length).reduceRight(getSum);
			  var y20ma =  value.slice(value.length-21,value.length-1).reduceRight(getSum);
			  var z20ma =  value.slice(value.length-22,value.length-2).reduceRight(getSum);
			  //console.log('20ma trend '+(z20ma/20).toFixed(2) + ' ' + (y20ma/20).toFixed(2) + ' ' + (x20ma/20).toFixed(2));
			  //end 20ma trend
			  //50ma trend
			  var x50ma =  value.slice(value.length-50,value.length).reduceRight(getSum);
			  var y50ma =  value.slice(value.length-51,value.length-1).reduceRight(getSum);
			  var z50ma =  value.slice(value.length-52,value.length-2).reduceRight(getSum);
			  //console.log('50ma trend '+(z50ma/50).toFixed(2) + ' ' + (y50ma/50).toFixed(2) + ' ' + (x50ma/50).toFixed(2));
			  //end 50ma trend
			  
			  var table = '<table>';
			    //table += '<tr>';
				//table += '<tr><td>' + '5ma trend ' +(z5ma/5).toFixed(2) + ' ' + (y5ma/5).toFixed(2) + ' ' + (x5ma/5).toFixed(2)+ '</td></tr>';
				table +='<tr>';
				if(z5ma > y5ma) {
				   console.log("yes");
					table += '<td> 5SMA </td><td>'+ (z5ma/5).toFixed(2) + '</td>' + '<td>' + (y5ma/5).toFixed(2) + '</td>';
				}
				else{
					table += '<td> 5SMA </td><td>'+ (z5ma/5).toFixed(2) + '</td>' + '<td>' + (y5ma/5).toFixed(2) + '</td>';
				}
				if(y5ma > x5ma){
					table +=  '<td>' + (x5ma/5).toFixed(2) + '</td>';
				}
				else{
					table +=  '<td>' + (x5ma/5).toFixed(2) + '</td>';
				}
				 table += '</tr>';
				//
							table +='<tr>';
				if(z10ma > y10ma) {
				   console.log("yes");
					table += '<td> 10SMA </td><td>'+ (z10ma/5).toFixed(2) + '</td>' + '<td>' + (y10ma/5).toFixed(2) + '</td>';
				}
				else{
					table += '<td> 10SMA </td><td>'+ (z10ma/5).toFixed(2) + '</td>' + '<td>' + (y10ma/5).toFixed(2) + '</td>';
				}
				if(y10ma > x10ma){
					table +=  '<td>' + (x10ma/5).toFixed(2) + '</td>';
				}
				else{
					table +=  '<td>' + (x10ma/5).toFixed(2) + '</td>';
				}
				 table += '</tr>';
				//
							table +='<tr>';
				if(z20ma > y20ma) {
				   console.log("yes");
					table += '<td> 20SMA </td><td>'+ (z20ma/5).toFixed(2) + '</td>' + '<td>' + (y20ma/5).toFixed(2) + '</td>';
				}
				else{
					table += '<td> 20SMA </td><td>'+ (z20ma/5).toFixed(2) + '</td>' + '<td>' + (y20ma/5).toFixed(2) + '</td>';
				}
				if(y20ma > x20ma){
					table +=  '<td>' + (x20ma/5).toFixed(2) + '</td>';
				}
				else{
					table +=  '<td>' + (x20ma/5).toFixed(2) + '</td>';
				}
				 table += '</tr>';
				//
							table +='<tr>';
				if(z50ma > y50ma) {
				   console.log("yes");
					table += '<td> 50 SMA </td><td>'+ (z50ma/5).toFixed(2) + '</td>' + '<td>' + (y50ma/5).toFixed(2) + '</td>';
				}
				else{
					table += '<td> 50 SMA </td><td>'+ (z50ma/5).toFixed(2) + '</td>' + '<td>' + (y50ma/5).toFixed(2) + '</td>';
				}
				if(y50ma > x50ma){
					table +=  '<td>' + (x50ma/5).toFixed(2) + '</td>';
				}
				else{
					table +=  '<td>' + (x50ma/5).toFixed(2) + '</td>';
				}
				 table += '</tr>';
				//
				
				
				
				
				
				 
				
				
			  
			 
			  table += '</table>';
			  $('.ma').html(table);
			
			  
			   
			   
			function getSum(total, num) {
			         return total+num;
				
				}
			
					
			
			
			
			
		});
		                      
				$.getJSON(url, function(data) {
                    
					 entries = data.feed.entry;
                    
					$(entries).each(function(index, entry){
					//console.log(entry.gsx$symbol.$t, input.toUpperCase())
				//make sure this matches your column labels when you change the source sheet
					if (entry.gsx$symbol.$t == input.toUpperCase()) {
                        
                        found = true;
                        
					    //alert(entry.gsx$pricetarget.$t);
						$('.notes').html('<b>'+entry.gsx$symbol.$t+'  Trend: '+entry.gsx$trend.$t+' Price Target: '+entry.gsx$pricetarget.$t+' Alert Value: '+ entry.gsx$alertvalue.$t+ ' Alert% : '+ entry.gsx$alertpercentage.$t +'Notes: ' +entry.gsx$comments.$t + ' Last Updated : ' + entry.gsx$date.$t+'</b>' );
						 //console.log(entry.gsx$weekly5ma1weeks.$t);
						 weekly5maprevious = entry.gsx$weekly5ma1weeks.$t;
						 var trend = [
						 [entry.gsx$daily5.$t,"5MA"],
						 [entry.gsx$daily10.$t,"10MA"],
						 [entry.gsx$daily20.$t,"20MA"],
						 [entry.gsx$daily50.$t,"50MA"],
						 [entry.gsx$daily100.$t,"100MA"],
						 [entry.gsx$daily200.$t,"200MA"],
						 [entry.gsx$weekly5ma.$t,"Weekly5SMA"],
						 [entry.gsx$weekly10sma.$t,"Weekly10SMA"],
						 [price,"Current Price"]
						 
                                          						 
						]
						 
						 $('.symbol').html('<br><br>'+entry.gsx$symbol.$t+'<br><br>');
						
						trend.sort();
						$('.notes').html("");
						if (entry.gsx$weekly5ma.$t > entry.gsx$weekly5ma1weeks.$t){
						
						$('.notes').append('<font color = "green" size = "6">5ma weekly pointing up</font>' + '(' + entry.gsx$weekly5ma1weeks.$t +')' );
						
						}
						else {
						$('.notes').append('<font color = "red" size = "6">5ma weekly pointing DOWN</font>' + '(' + entry.gsx$weekly5ma1weeks.$t +')');
						}
						
						
						if (entry.gsx$weekly10sma.$t > entry.gsx$weekly10sma1weeks.$t){
						
						$('.notes').append('<br><font color = "green" size = "6">10ma weekly pointing up</font>' + '(' + entry.gsx$weekly10sma1weeks.$t +')');
						
						}
						else {
						$('.notes').append('<br><font color = "red" size = "6">10ma weekly pointing DOWN</font>' + '(' + entry.gsx$weekly10sma1weeks.$t +')');
						}
						
						
						
							var html = '<table>';
							html += '<tr>';
						
							html += '</tr>';
							for( var i = 0; i < trend.length; i++) {
								html += '<tr>';
								
								
							
								    if(trend[i][1]== 'Current Price'){
										html += '<td><font color = "red">' + trend[i][1] + '</font></td>';
										html += '<td><font color = "red">' + trend[i][0]+'</font></td>';
										html += '</tr>';
										}
									
									else{
										html += '<td>' + trend[i][1] + '</td>';
										html += '<td>' + trend[i][0]+'</td>';
										html += '</tr>';
									}
                            
												 
							}
							
						
								html += '</table>';
							 $('.trend').html(html);
							 
						
						
						
						}
						
					});
                   if(found == false) {
                        $('.notes').html(`SYMBOL NOT FOUND: ${input}`);
                   }                   
				});
			
  
    }
    
    $("input").change(getData);

    $(function() {
        var urlParams = new URLSearchParams(window.location.search);
        //console.log(urlParams.toString());
        var ticker = urlParams.get('tickerSymbol');
        //console.log(ticker);
        $('#tickerSymbol').val(ticker);
        //console.log($('#tickerSymbol').val());
        getData();
    });
	

	
   </script>
   

   
   
   
   
<!--<canvas id="myChart" width="20" height="20"></canvas>

      <script>
var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
        datasets: [{
            label: '# of Votes',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
		 </script>-->

   </body>
</html>