<head>
 <!-- Include Plotly.js -->
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
 <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>
  <div id="myDiv">
    <!-- Plotly chart will be drawn inside this DIV -->
  </div>
  <script>
//get stock data

//calculate 10 day moving average last value
// calculate 20 day ma
// calculate 50 day ma
//calculate 100 day ma
//calculate 200 day ma
//calcualte ATR ( - and +)
//Render on chart 

//
var chart = 'https://api.iextrading.com/1.0/stock/aapl/chart/3m';

var value=[];
var date=[];
var close=[];
var high=[];
var low=[];
var open=[];


$.getJSON(chart, function(data){
  $.each(data,function(index, daily){
   value.push(daily.close);
   date.push(daily.date);
   close.push(daily.close);
   high.push(high.close);
   low.push(low.close);
   open.push(open.close);
 })


  ma10 = currentMa(10);
  ma20 = currentMa(20);
  ma50 = currentMa(50);
  ma100 = currentMa(100);
  console.log(ma10,ma20,ma50,ma100);

  function currentMa(n){
    return (value.slice(value.length-n,value.length).reduce(getSum)/n).toFixed(2);

  }



  function getSum(total, num) {
   total = total+num;
   return total;

 }

 var trace1 = {
   y: value,
   x: date,
   type: 'scatter',
   mode:'lines'
 };


 
 var layout = {"yaxis":{"title":"Price","showgrid":false,"side":"left"},"yaxis2":{"title":"Price","showgrid":false,"side":"right","overlaying":"y"},"xaxis":{"type":"date","title":"Date","nticks":30,"tickangle":45,"showgrid":false},"title":"AAPL price","width":1600.0,"height":750.0};
//


///

 var data = [trace1];

 Plotly.newPlot('myDiv', data,layout);

//candlestick


})
</script>
</body>