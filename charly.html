<head>
 <!-- Include Plotly.js -->
 <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
 <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
 <script src="https://momentjs.com/downloads/moment.min.js"></script>
 <style>
    table {
        border-spacing: 0px;
        border: 1px solid black;
    }
    th, td {
        padding-top: 3px;
        padding-left: 3px;
        padding-bottom: 3px;
        padding-right: 10px;
        text-align: center;
        margin-right:5px;
    }
    th{
        font-weight: bold;
        font-size: 16;
    }
     tr:nth-child(even) {background-color: lightgrey;}
</style>
</head>
<body>
  <div class="ind">
  </div>
  <div class="tlb">
  </div>
  <script>

function indicators(symbol){
var chart = 'https://cors.io?https://us-central1-stocks-235104.cloudfunctions.net/tsi?name='+symbol;
var tlb = 'https://cors.io?https://us-central1-stocks-235104.cloudfunctions.net/tilb?name='+symbol;
var html='';
var tlbhtml='';
$.getJSON(chart, function(data){
     html += '<table>';
     html += '<th>Date<th>Close</th><th>$change</th><th>%volchange</th><th>tsi</th><th>ATR14</th><th>ATR20</th><th>10Day</th><th>20Day</th><th>50Day</th><th>100Day</th><th>200Day</th>'
  $.each(data,function(index, daily){
      html+='<tr><td>'+moment(daily.Date).format("MM/DD/YYYY")+'</td><td>'+daily.Close.toFixed(2)+'</td>';
      html+= '<td>'+daily.change.toFixed(2)+'</td><td>'+daily.Volchange.toFixed(2)+'</td>';
      html+='<td>'+daily.tsi.toFixed(2)+'</td><td>'+daily.ATR14.toFixed(2)+'</td>';
      html+='<td>'+daily.ATR20.toFixed(2)+'</td><td>'+daily["10sma"].toFixed(2)+'</td>';
      html+='<td>'+daily["20sma"].toFixed(2)+'</td><td>'+daily["50sma"].toFixed(2)+'</td>';
      html+='<td>'+daily["100sma"].toFixed(2)+'</td><td>'+daily["200sma"].toFixed(2)+'</td></tr>';
    });
  html +='</table>';


$('.ind').html(html);
});
$.getJSON(tlb, function(data){
     tlbhtml += '<br><br><table>';
     tlbhtml += '<th>Date</th><th>High</th><th>Low</th><th>Uptrend</th>'
  $.each(data,function(index, three){
      tlbhtml+='<tr><td>'+moment(three.date).format("MM/DD/YYYY")+'</td><td>'+three.high.toFixed(2)+'</td><td>'+three.low.toFixed(2)+'</td><td>'
      +three.uptrend+'</td></tr>';   
    });
  tlbhtml +='</table>';
$('.tlb').html(tlbhtml);
});


}

    $(function() {
      var urlParams = new URLSearchParams(window.location.search);
        //console.log(urlParams.toString());
        var ticker = urlParams.get('tickerSymbol');
        //console.log(ticker);
        $('#tickerSymbol').val(ticker);
        //console.log($('#tickerSymbol').val());
        indicators(ticker);
    });
   

</script>
</body>